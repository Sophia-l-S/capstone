<!-- Sophia Scott Pet project html -->
<!doctype html>
<html lang="en">

<head>
    <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <script src="jquery-3.6.1.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script type="text/javascript" src="petJS.js"></script>
    <link rel="stylesheet" href="petCss.css" />
</head>

<body>

    <h2>Schedule Time Calculator</h2>
    <p>This program will help you plan out your week!</p>
    <p>Click on the the spaces to enter the aproprate number of hours</p>
    <p>Before you begin be sure to customize(Edit button) the fixed number of hours for all other activities (Ex. sleep,
        meals, travel)</p>
    <p>When you are finshed hover your mouse over the bottom row boxes to see the updated number of hours</p>

    <label for="weekPicker">Select a week:</label>
    <input type="date" id="weekPicker" name="weekPicker" onchange="updateDates()">
    <br>
    <br>


    <button id="addRowButton">Add Activity</button>
    <table id="scheduleTable">
        <tr>
            <th id="empty"></th>
            <th id="headerM">Monday</th>
            <th id="headerTu">Tuesday</th>
            <th id="headerW">Wednesday</th>
            <th id="headerT">Thursday</th>
            <th id="headerF">Friday</th>
            <th id="headerS">Saturday</th>
            <th id="headerSu">Sunday</th>
        </tr>
        <script>
            function updateDates() {
                var weekPicker = document.getElementById("weekPicker");
                var chosenDate = new Date(weekPicker.value);
                var daysOfWeek = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];

                var headerCells = document.getElementsByTagName('th');
                for (var i = 1; i < headerCells.length; i++) {
                    var dayIndex = chosenDate.getDay() + i - 1;
                    if (dayIndex > 6) {
                        dayIndex -= 7;
                    }
                    headerCells[i].textContent = daysOfWeek[dayIndex] + ' (' + (chosenDate.getDate() + i - 1) + ')';
                }
            }
        </script>
        <!-- <tr>
            <th> </th>
            <th><span id="dateM"></span></th>
            <th><span id="dateTu"></span></th>
            <th><span id="dateW"></span></th>
            <th><span id="dateT"></span></th>
            <th><span id="dateF"></span></th>
            <th><span id="dateS"></span></th>
            <th><span id="dateSu"></span></th>
        </tr> -->
        <script>

        </script>
        <tr id="schoolhours">
            <td>School Hours:</td>
            <td id="SHM"> Click to Add Hours </td>
            <td id="SHTu"> Click to Add Hours </td>
            <td id="SHW"> Click to Add Hours </td>
            <td id="SHT"> Click to Add Hours </td>
            <td id="SHF"> Click to Add Hours </td>
            <td id="SHS"> Click to Add Hours </td>
            <td id="SHSu"> Click to Add Hours </td>
            <td><button onclick="deleteSchoolHoursRow()">Delete</button></td>
        </tr>
        <tr id="workhours">
            <td>Work Hours:</td>
            <td id="WHM"> Click to Add Hours </td>
            <td id="WHTu"> Click to Add Hours </td>
            <td id="WHW"> Click to Add Hours </td>
            <td id="WHT"> Click to Add Hours </td>
            <td id="WHF"> Click to Add Hours </td>
            <td id="WHS"> Click to Add Hours </td>
            <td id="WHSu"> Click to Add Hours </td>
            <td><button onclick="deleteWorkHoursRow()">Delete</button></td>
        </tr>
        <tr>
            <td id="allother">Hours for all other activities:</td>
            <td id="OtherM"> Click to Add Hours </td>
            <td id="OtherTu"> Click to Add Hours </td>
            <td id="OtherW"> Click to Add Hours </td>
            <td id="OtherT"> Click to Add Hours </td>
            <td id="OtherF"> Click to Add Hours </td>
            <td id="OtherS"> Click to Add Hours </td>
            <td id="OtherSu"> Click to Add Hours </td>
            <td><button id="editButton" onclick="editallother()">Edit</button></td>
        </tr>
        <script>


            function deleteSchoolHoursRow() {
                var confirmation = confirm("Are you sure you want to delete this row?");
                if (confirmation) {
                    var row = document.getElementById("schoolhours");
                    row.parentNode.removeChild(row);

                    // Reset school hours values to 0
                    document.getElementById("shm").innerHTML = "0";
                    document.getElementById("SHTu").textContent = "0";
                    document.getElementById("SHW").textContent = "0";
                    document.getElementById("SHT").textContent = "0";
                    document.getElementById("SHF").textContent = "0";
                    document.getElementById("SHS").textContent = "0";
                    document.getElementById("SHSu").textContent = "0";
                }
            }
            function deleteWorkHoursRow() {
                var confirmation = confirm("Are you sure you want to delete this row?");
                if (confirmation) {
                    var row = document.getElementById("workhours");
                    row.parentNode.removeChild(row);

                    // Reset work hours values to 0
                    document.getElementById("WHM").textContent = "0";
                    document.getElementById("WHTu").textContent = "0";
                    document.getElementById("WHW").textContent = "0";
                    document.getElementById("WHT").textContent = "0";
                    document.getElementById("WHF").textContent = "0";
                    document.getElementById("WHS").textContent = "0";
                    document.getElementById("WHSu").textContent = "0";
                }
            }
        </script>
    </table>
    <table id="scheduleTable">
        <!-- <tr>
            <th id="empty"> </th>
            <th>Monday</th>
            <th>Tuseday</th>
            <th>Wednsday</th>
            <th>Thursday</th>
            <th>Friday</th>
            <th>Saturday</th>
            <th>Sunday</th>
        </tr> -->
        <tr id="bottomRow">
            <td>Hours left in the day:</td>
            <td id="LeftM">Hover to see total</td>
            <td id="LeftTu">Hover to see total</td>
            <td id="LeftW">Hover to see total</td>
            <td id="LeftT">Hover to see total</td>
            <td id="LeftF">Hover to see total</td>
            <td id="LeftS">Hover to see total</td>
            <td id="LeftSu">Hover to see total</td>
            <!-- <td> </td> -->
        </tr>
    </table>
    <button type="button" onclick="saveTable()">Save</button>
    <div id="savedTables">
        <h3>Saved Tables</h3>
        <div>
            <button onclick="previousTable()">&#8249;</button>
            <button onclick="nextTable()">&#8250;</button>
            <button id="deleteButton" onclick="deleteCurrentTable()">Delete</button>
        </div>
        <div id="message"></div>
        <table id="savedTable"></table>
    </div>

    <script>
        var savedTables = [];
        var currentTableIndex = -1;

        // Load saved tables from local storage on page load
        window.addEventListener('load', function () {
            var storedTables = localStorage.getItem('savedTables');
            if (storedTables) {
                savedTables = JSON.parse(storedTables);
                currentTableIndex = Math.max(savedTables.length - 1, -1);
                displaySavedTable();
            }
        });

        function saveTable() {
            var scheduleTable = document.getElementById("scheduleTable").cloneNode(true);
            var date = document.getElementById("weekPicker").value;

            var deleteButtons = scheduleTable.querySelectorAll("button");
            for (var i = 0; i < deleteButtons.length; i++) {
                deleteButtons[i].parentNode.removeChild(deleteButtons[i]);
            }

            var editButton = scheduleTable.querySelector("#editButton");
            if (editButton) {
                editButton.parentNode.removeChild(editButton);
            }

            var bottomRow = document.getElementById("bottomRow").cloneNode(true);
            scheduleTable.appendChild(bottomRow);

            savedTables.push({
                date: date,
                table: scheduleTable.innerHTML
            });

            // Save updated tables to local storage
            localStorage.setItem('savedTables', JSON.stringify(savedTables));

            // Make AJAX request to save_table.php
            var xhr = new XMLHttpRequest();
            xhr.open("POST", "save_table.php", true);
            xhr.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
            xhr.onreadystatechange = function () {
                if (xhr.readyState === 4 && xhr.status === 200) {
                    showSaveMessage();
                }
            };
            xhr.send("date=" + encodeURIComponent(date) + "&table=" + encodeURIComponent(scheduleTable.innerHTML));
        }


        function clearSavedTables() {
            savedTables = [];
            currentTableIndex = -1;
            localStorage.removeItem('savedTables');
            displaySavedTable();
        }

        function showSaveMessage() {
            var message = document.getElementById("message");
            message.textContent = "Table has been saved.";

            setTimeout(function () {
                message.textContent = "";
            }, 3000);
        }

        function previousTable() {
            if (currentTableIndex > 0) {
                currentTableIndex--;
                displaySavedTable();
            }
        }

        function nextTable() {
            if (currentTableIndex < savedTables.length - 1) {
                currentTableIndex++;
                displaySavedTable();
            }
        }

        function displaySavedTable() {
            var savedTable = document.getElementById("savedTable");
            savedTable.innerHTML = "";

            if (savedTables.length === 0) {
                savedTable.textContent = "No saved tables.";
                return;
            }

            var currentTableData = savedTables[currentTableIndex];
            var currentTable = document.createElement("table");
            currentTable.innerHTML = currentTableData.table;
            savedTable.appendChild(currentTable);

            updateDeleteButton();
        }

        function updateDeleteButton() {
            var deleteButton = document.getElementById("deleteButton");

            // Remove existing delete button if it exists
            if (deleteButton) {
                deleteButton.parentNode.removeChild(deleteButton);
            }

            deleteButton = document.createElement("button");
            deleteButton.id = "deleteButton";
            deleteButton.textContent = "Delete";
            deleteButton.onclick = function () {
                deleteCurrentTable();
            };

            var savedTablesDiv = document.getElementById("savedTables");
            savedTablesDiv.insertBefore(deleteButton, savedTable);
        }

        function deleteCurrentTable() {
            var confirmation = confirm("Are you sure you want to delete this saved table?");
            if (confirmation && currentTableIndex >= 0 && currentTableIndex < savedTables.length) {
                savedTables.splice(currentTableIndex, 1);
                currentTableIndex = Math.min(currentTableIndex, savedTables.length - 1);
                displaySavedTable();
                showDeleteMessage();

                // Save updated tables to local storage
                localStorage.setItem('savedTables', JSON.stringify(savedTables));
            }
        }

        function showDeleteMessage() {
            var message = document.getElementById("message");
            message.textContent = "The saved table has been deleted.";

            setTimeout(function () {
                message.textContent = "";
            }, 3000);
        }
    </script>

</body>

</html>